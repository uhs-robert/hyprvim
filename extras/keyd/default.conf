# /etc/keyd/default.conf
#
#    ██╗  ██╗███████╗██╗   ██╗██████╗ ██╗   ██╗██╗███╗   ███╗
#    ██║ ██╔╝██╔════╝╚██╗ ██╔╝██╔══██╗██║   ██║██║████╗ ████║
#    █████╔╝ █████╗   ╚████╔╝ ██║  ██║██║   ██║██║██╔████╔██║
#    ██╔═██╗ ██╔══╝    ╚██╔╝  ██║  ██║╚██╗ ██╔╝██║██║╚██╔╝██║
#    ██║  ██╗███████╗   ██║   ██████╔╝ ╚████╔╝ ██║██║ ╚═╝ ██║
#    ╚═╝  ╚═╝╚══════╝   ╚═╝   ╚═════╝   ╚═══╝  ╚═╝╚═╝     ╚═╝
#
################################################################################
# KEYDVIM - BASIC VIM-STYLE KEYBINDINGS AND SHORTCUTS
################################################################################
#
# - When 'capslock' is tapped (pressed + released), it behaves as the ESC key
# - When 'capslock' is held it behaves like a 'ctrl' key modifier
# - When 'tab' is held, enter a "vim-lite" layer (keybinds only)
#     This is useful for people who don't run Hyprland but still want a minimal,
#     universal vim-like experience at the OS level.
#
################################################################################
#
# Limitations:
#   This config only remaps keys (no shell script execution and no status
#   indicator), so this is an intentionally light setup but it is still robust.
#   Useful for quick one-off `hjkl` movement or non-advanced text manipulation and
#   navigation. Although HyprVim is currently the more comprehensive solution for
#   vim emulation, this could be edited to used shell scripts; but do so with
#   care as scripts run by keyd are run as root. Also every key must be unmapped
#   individually to prevent fallthrough.
#
################################################################################
#
# How to Exit "vim-lite":
#   Like vim, you may get trapped in vim-lite. To escape, here are two ways:
#     - `<ALT>+<ESCAPE>` or `<CAPSLOCK>+<ESCAPE>` will exit vim-lite
#     - `<backspace>+<escape>+<enter>` will terminate keyd
#
################################################################################

# ---------------------------------------------------------------------------- #
# !-- IDS
# ---------------------------------------------------------------------------- #

[ids]

*

# ---------------------------------------------------------------------------- #
# !-- MAIN
# ---------------------------------------------------------------------------- #

# NOTE: Capslock or Control to act as escape when tapped. Pick one or both.
# If you opt to disable then search and comment out each instance in config.
[main]

capslock = overload(ctrl_vim, esc)
leftcontrol = overload(ctrl_vim, esc)
tab = overload(normal_mode, tab)

# ---------------------------------------------------------------------------- #
# !-- ALT
# ---------------------------------------------------------------------------- #

# Global escape hatch when trapped inside a toggled mode.
#   Disables both HyprVim and Keyd vim modes.
[alt]

capslock = clearm(macro(leftalt+esc))
esc = clearm(macro(leftalt+esc))

[altgr]

capslock = clearm(macro(leftalt+esc))
esc = clearm(macro(leftalt+esc))

# ---------------------------------------------------------------------------- #
# !-- CTRL VIM
# ---------------------------------------------------------------------------- #

# Permanently toggle vim-lite: [TAB]+[BACKSPACE] while holding CAPSLOCK or CTRL
[ctrl_vim:C]

backspace = toggle(normal_mode)
# WARN: To exit this mode, use global escape hatch above: [ALT]+[ESCAPE]

# ---------------------------------------------------------------------------- #
# !-- SHIFT VIM
# ---------------------------------------------------------------------------- #

# Shortcut to v-line
[vim_shift:S]

v = swapm(vline_mode, macro(end S-home))

# ---------------------------------------------------------------------------- #
# !-- NORMAL MODE
# ---------------------------------------------------------------------------- #

[normal_mode]

## Movement
h = left
j = down
k = up
l = right
0 = home
n = f3

## Mode switching
i = swap(insert_mode)
c = oneshot(c_normal_mode)
d = oneshot(d_normal_mode)
y = oneshot(y_normal_mode)
a = swapm(insert_mode, right)
o = swapm(insert_mode, macro(end enter))
g = oneshot(g_mode)
v = swap(visual_mode)
leftshift = swap(vim_shift)
rightshift = swap(vim_shift)

## Text
b = C-left
w = macro(C-right C-right C-left)
e = macro(right C-right left)

## Actions
u = C-z
x = delete
p = C-v
. = repeat()
/ = C-f

## Unmap unused keys
f = noop
m = noop
q = noop
r = noop
s = noop
t = noop
z = noop
1 = noop
2 = noop
3 = noop
4 = noop
5 = noop
6 = noop
7 = noop
8 = noop
9 = noop

# !-- NORMAL MODE + SHIFT ----------------------------------------------------

[normal_mode+shift]

### Movement
h = home
j = C-down
k = C-up
l = end
6 = home
4 = end
g = C-end
n = S-f3
[ = C-up
] = C-down

## Mode switching
o = swapm(insert_mode, macro(end up enter))
i = swap(insert_mode)
a = swapm(insert_mode, end)

### Text
b = C-left
w = macro(C-right C-right C-left)
e = macro(right C-right left)

### Actions
x = backspace
/ = C-f
c = macro(C-S-end S-delete)
d = macro(C-S-end S-delete)
y = macro(C-S-end C-insert)
p = macro(home enter up S-insert)

#### Search highlighted word
8 = macro(C-right C-S-left 20ms C-insert 10ms C-f 20ms S-insert)
3 = macro(C-right C-S-left 20ms C-insert 10ms C-f 20ms S-insert)

## Unmap unused keys
f = noop
m = noop
q = noop
r = noop
s = noop
t = noop
u = noop
z = noop
0 = noop
1 = noop
2 = noop
5 = noop
7 = noop
9 = noop

# !-- NORMAL MODE + CONTROL --------------------------------------------------

[normal_mode+control]

## Movement
d = pagedown
u = pageup
f = scrolldown
b = scrollup

### Actions
r = C-y

# !-- NORMAL MODE (Change) [ONE SHOT] -------------------------------------

[c_normal_mode]

## Actions
c = swapm(insert_mode, macro(home S-end S-delete))
i = oneshot(ci_normal_mode)
a = oneshot(ci_normal_mode)

## Unmap unused keys
b = noop
d = noop
e = noop
f = noop
g = noop
h = noop
j = noop
k = noop
l = noop
m = noop
n = noop
o = noop
p = noop
q = noop
r = noop
s = noop
t = noop
u = noop
v = noop
w = noop
x = noop
y = noop
z = noop
0 = noop
1 = noop
2 = noop
3 = noop
4 = noop
5 = noop
6 = noop
7 = noop
8 = noop
9 = noop

# !-- NORMAL MODE (Change/Inner/A) [ONE SHOT] -----------------------------

[ci_normal_mode]

## Actions
w = swapm(insert_mode, macro(C-right C-S-left S-delete))
p = swapm(insert_mode, macro(C-up C-S-down S-delete))

## Unmap unused keys
a = noop
b = noop
c = noop
d = noop
e = noop
f = noop
g = noop
h = noop
j = noop
k = noop
l = noop
m = noop
n = noop
o = noop
q = noop
r = noop
s = noop
t = noop
u = noop
v = noop
x = noop
y = noop
z = noop
0 = noop
1 = noop
2 = noop
3 = noop
4 = noop
5 = noop
6 = noop
7 = noop
8 = noop
9 = noop

# !-- NORMAL MODE (Delete) [ONE SHOT] -------------------------------------

[d_normal_mode]

## Actions
d = macro(home C-S-end S-delete)
i = oneshot(di_normal_mode)
a = oneshot(di_normal_mode)

## Unmap unused keys
b = noop
c = noop
e = noop
f = noop
g = noop
h = noop
j = noop
k = noop
l = noop
m = noop
n = noop
o = noop
p = noop
q = noop
r = noop
s = noop
t = noop
u = noop
v = noop
w = noop
x = noop
y = noop
z = noop
0 = noop
1 = noop
2 = noop
3 = noop
4 = noop
5 = noop
6 = noop
7 = noop
8 = noop
9 = noop

# !-- NORMAL MODE (Delete/Inner/A) [ONE SHOT] -----------------------------
[di_normal_mode]

## Actions
w = macro(C-right C-S-left S-delete)
p = macro(C-up C-S-down S-delete)

## Unmap unused keys
a = noop
b = noop
c = noop
d = noop
e = noop
f = noop
g = noop
h = noop
i = noop
j = noop
k = noop
l = noop
m = noop
n = noop
o = noop
q = noop
r = noop
s = noop
t = noop
u = noop
v = noop
x = noop
y = noop
z = noop
0 = noop
1 = noop
2 = noop
3 = noop
4 = noop
5 = noop
6 = noop
7 = noop
8 = noop
9 = noop

# !-- NORMAL MODE (Yank) [ONE SHOT] ---------------------------------------

[y_normal_mode]

## Actions
y = macro(home C-S-end C-c)
i = oneshot(yi_normal_mode)
a = oneshot(yi_normal_mode)

## Unmap unused keys
b = noop
c = noop
d = noop
e = noop
f = noop
g = noop
h = noop
j = noop
k = noop
l = noop
m = noop
n = noop
o = noop
p = noop
q = noop
r = noop
s = noop
t = noop
u = noop
v = noop
w = noop
x = noop
z = noop
0 = noop
1 = noop
2 = noop
3 = noop
4 = noop
5 = noop
6 = noop
7 = noop
8 = noop
9 = noop

# !-- NORMAL MODE (Yank/Inner/A) [ONE SHOT] -------------------------------
[yi_normal_mode]

## Actions
w = macro(C-right C-S-left C-c)
p = macro(C-up C-S-down C-c)

## Unmap unused keys
a = noop
b = noop
c = noop
d = noop
e = noop
f = noop
g = noop
h = noop
i = noop
j = noop
k = noop
l = noop
m = noop
n = noop
o = noop
q = noop
r = noop
s = noop
t = noop
u = noop
v = noop
x = noop
y = noop
z = noop
0 = noop
1 = noop
2 = noop
3 = noop
4 = noop
5 = noop
6 = noop
7 = noop
8 = noop
9 = noop

# ---------------------------------------------------------------------------- #
# !-- INSERT MODE
# ---------------------------------------------------------------------------- #

[insert_mode]

## Mode changes
esc = swap(normal_mode)
capslock = swap(normal_mode)
leftcontrol = swap(normal_mode)

# !-- INSERT MODE + CONTRL ----------------------------------------------------
[insert_mode+control]
o = oneshot(normal_mode)

# ---------------------------------------------------------------------------- #
# !-- G MODE
# ---------------------------------------------------------------------------- #

[g_mode]

## Mode changes
g = C-home
e = macro(C-left C-right)

## Unmap unused keys
a = noop
b = noop
c = noop
d = noop
f = noop
h = noop
i = noop
j = noop
k = noop
l = noop
m = noop
n = noop
o = noop
p = noop
q = noop
r = noop
s = noop
t = noop
u = noop
v = noop
w = noop
x = noop
y = noop
z = noop
0 = noop
1 = noop
2 = noop
3 = noop
4 = noop
5 = noop
6 = noop
7 = noop
8 = noop
9 = noop

# ---------------------------------------------------------------------------- #
# !-- VISUAL MODE
# ---------------------------------------------------------------------------- #

[visual_mode]

## Movement
h = S-left
j = S-down
k = S-up
l = S-right
0 = S-home
6 = S-home
- = S-home
4 = S-end

## Text
w = C-S-right
e = C-S-right
b = C-S-left

## Operators
d = macro(S-delete esc)
y = macro(C-c esc)
c = macro(S-delete esc)
x = macro(S-delete esc)

## Mode Switches
i = oneshot(i_visual_mode)
a = oneshot(i_visual_mode)
g = oneshot(g_visual_mode)
v = swap(normal_mode)
esc = swap(normal_mode)
capslock = swap(normal_mode)
leftcontrol = swap(normal_mode)
leftshift = layer(vim_shift)
rightshift = layer(vim_shift)

## Unmap unused keys
f = noop
m = noop
n = noop
o = noop
p = noop
q = noop
r = noop
s = noop
t = noop
u = noop
z = noop
1 = noop
2 = noop
3 = noop
5 = noop
7 = noop
8 = noop
9 = noop

# !-- VISUAL MODE + SHIFT ----------------------------------------------------

[visual_mode+shift]

## Movement
h = S-left
j = S-down
k = S-up
l = S-right
g = C-S-end
4 = S-end
6 = S-home

## Mode change
v = swap(visual_mode)

## Unmap unused keys
a = noop
b = noop
c = noop
d = noop
e = noop
f = noop
i = noop
m = noop
n = noop
o = noop
p = noop
q = noop
r = noop
s = noop
t = noop
u = noop
w = noop
x = noop
y = noop
z = noop
0 = noop
1 = noop
2 = noop
3 = noop
5 = noop
7 = noop
8 = noop
9 = noop

# !-- VISUAL MODE (INNER/A) [ONE SHOT] ------------------------------------

[i_visual_mode]

## Actions
w = macro(C-right C-S-left)
p = macro(C-up C-S-down)

## Unmap unused keys
a = noop
b = noop
c = noop
d = noop
e = noop
f = noop
g = noop
h = noop
i = noop
j = noop
k = noop
l = noop
m = noop
n = noop
o = noop
q = noop
r = noop
s = noop
t = noop
u = noop
v = noop
x = noop
y = noop
z = noop
0 = noop
1 = noop
2 = noop
3 = noop
4 = noop
5 = noop
6 = noop
7 = noop
8 = noop
9 = noop

# !-- G VISUAL MODE [ONE SHOT] --------------------------------------------

[g_visual_mode]

## Actions
g = C-S-home

## Unmap unused keys
a = noop
b = noop
c = noop
d = noop
e = noop
f = noop
h = noop
i = noop
j = noop
k = noop
l = noop
m = noop
n = noop
o = noop
p = noop
q = noop
r = noop
s = noop
t = noop
u = noop
v = noop
w = noop
x = noop
y = noop
z = noop
0 = noop
1 = noop
2 = noop
3 = noop
4 = noop
5 = noop
6 = noop
7 = noop
8 = noop
9 = noop

# ---------------------------------------------------------------------------- #
# !-- VISUAL LINE MODE
# ---------------------------------------------------------------------------- #

[vline_mode]
h = S-left
j = S-down
k = S-up
l = S-right

## Operators
d = swapm(normal_mode, S-delete)
y = swapm(normal_mode, C-insert)
c = swapm(normal_mode, S-delete)
x = swapm(normal_mode, S-delete)

## Mode Switches
g = oneshot(g_vline_mode)
v = swapm(visual_mode, left)
esc = swap(normal_mode)
capslock = swap(normal_mode)

## Unmap unused keys
a = noop
b = noop
e = noop
f = noop
i = noop
m = noop
n = noop
o = noop
p = noop
q = noop
r = noop
s = noop
t = noop
u = noop
w = noop
z = noop
0 = noop
1 = noop
2 = noop
3 = noop
4 = noop
5 = noop
6 = noop
7 = noop
8 = noop
9 = noop

# !-- VISUAL LINE MODE + SHIFT -----------------------------------------------

[vline_mode+shift]
v = swapm(visual_mode, left)
g = macro(home C-S-end)

## Unmap unused keys
a = noop
b = noop
c = noop
d = noop
e = noop
f = noop
h = noop
i = noop
j = noop
k = noop
l = noop
m = noop
n = noop
o = noop
p = noop
q = noop
r = noop
s = noop
t = noop
u = noop
w = noop
x = noop
y = noop
z = noop
0 = noop
1 = noop
2 = noop
3 = noop
4 = noop
5 = noop
6 = noop
7 = noop
8 = noop
9 = noop

# ---------------------------------------------------------------------------- #
# !-- G VISUAL LINE MODE
# ---------------------------------------------------------------------------- #

[g_vline_mode]
g = macro(end C-S-home)

## Unmap unused keys
a = noop
b = noop
c = noop
d = noop
e = noop
f = noop
h = noop
i = noop
j = noop
k = noop
l = noop
m = noop
n = noop
o = noop
p = noop
q = noop
r = noop
s = noop
t = noop
u = noop
v = noop
w = noop
x = noop
y = noop
z = noop
0 = noop
1 = noop
2 = noop
3 = noop
4 = noop
5 = noop
6 = noop
7 = noop
8 = noop
9 = noop

# !-- G VISUAL LINE MODE + SHIFT ---------------------------------------------

[g_vline_mode+shift]
g = macro(home C-S-end)

## Unmap unused keys
a = noop
b = noop
c = noop
d = noop
e = noop
f = noop
h = noop
i = noop
j = noop
k = noop
l = noop
m = noop
n = noop
o = noop
p = noop
q = noop
r = noop
s = noop
t = noop
u = noop
v = noop
w = noop
x = noop
y = noop
z = noop
0 = noop
1 = noop
2 = noop
3 = noop
4 = noop
5 = noop
6 = noop
7 = noop
8 = noop
9 = noop

